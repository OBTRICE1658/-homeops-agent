<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connect Your Life Intelligence - HomeOps</title>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .container {
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            padding: 50px 40px;
            max-width: 700px;
            width: 90%;
            text-align: center;
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background: #e2e8f0;
            border-radius: 2px;
            margin-bottom: 40px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 33%;
            transition: width 0.3s ease;
        }
        
        .step-indicator {
            color: #718096;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .headline {
            font-size: 28px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 16px;
        }
        
        .story-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
            text-align: left;
            border-left: 4px solid #667eea;
        }
        
        .story-headline {
            font-size: 16px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
        }
        
        .story-icon {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            color: #667eea;
        }
        
        .story-text {
            color: #4a5568;
            line-height: 1.6;
            font-size: 15px;
            margin-bottom: 16px;
        }
        
        .security-badges {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 32px;
        }
        
        .security-badge {
            display: flex;
            align-items: center;
            background: #e6fffa;
            color: #234e52;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .security-badge i {
            width: 16px;
            height: 16px;
            margin-right: 6px;
        }
        
        .connection-cards {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .connection-card {
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 24px;
            text-align: left;
            transition: all 0.2s;
            position: relative;
        }
        
        .connection-card.connected {
            border-color: #48bb78;
            background: #f0fff4;
        }
        
        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }
        
        .card-title {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: #2d3748;
            font-size: 18px;
        }
        
        .card-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            color: #667eea;
        }
        
        .card-status {
            font-size: 14px;
            padding: 4px 12px;
            border-radius: 16px;
            font-weight: 500;
        }
        
        .status-pending {
            background: #fed7d7;
            color: #c53030;
        }
        
        .status-connected {
            background: #c6f6d5;
            color: #2f855a;
        }
        
        .card-description {
            color: #718096;
            font-size: 15px;
            margin-bottom: 8px;
        }
        
        .card-privacy {
            color: #48bb78;
            font-size: 13px;
            font-weight: 500;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
        }
        
        .card-privacy i {
            width: 14px;
            height: 14px;
            margin-right: 6px;
        }
        
        .connect-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .connect-btn:hover {
            transform: translateY(-1px);
        }
        
        .connect-btn:disabled {
            background: #e2e8f0;
            color: #a0aec0;
            cursor: not-allowed;
            transform: none;
        }
        
        .connect-btn i {
            width: 18px;
            height: 18px;
            margin-right: 8px;
        }
        
        .continue-section {
            padding-top: 30px;
            border-top: 1px solid #e2e8f0;
        }
        
        .continue-btn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            opacity: 0.5;
            cursor: not-allowed;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
        
        .continue-btn.ready {
            opacity: 1;
            cursor: pointer;
        }
        
        .continue-btn.ready:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(72, 187, 120, 0.3);
        }
        
        .continue-btn i {
            width: 18px;
            height: 18px;
            margin-left: 8px;
        }
        
        .skip-link {
            display: block;
            margin-top: 16px;
            color: #718096;
            text-decoration: none;
            font-size: 14px;
        }
        
        .skip-link:hover {
            color: #4a5568;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="progress-bar">
            <div class="progress-fill"></div>
        </div>
        
        <div class="step-indicator">Step 1 of 3</div>
        <h1 class="headline">Connect Your Mental Load Intelligence</h1>
        
        <div class="story-section">
            <div class="story-headline">
                <i data-lucide="heart" class="story-icon"></i>
                Built by a Parent, For Parents
            </div>
            <div class="story-text">
                HomeOps was created by a frustrated parent tired of being the family's "memory keeper." You know the feeling—tracking school events, managing everyone's schedules, remembering which brands actually work, filtering through hundreds of emails to find what matters.
            </div>
            <div class="story-text">
                <strong>We built this with parent-level security and privacy</strong> because we're parents too. Your data isn't sold, shared, or used for ads. It stays yours, protected with the same care we'd want for our own families.
            </div>
        </div>
        
        <div class="security-badges">
            <div class="security-badge">
                <i data-lucide="shield-check"></i>
                Parent-Built Security
            </div>
            <div class="security-badge">
                <i data-lucide="lock"></i>
                Your Data Stays Yours
            </div>
            <div class="security-badge">
                <i data-lucide="eye-off"></i>
                No Ads, No Tracking
            </div>
        </div>
        
        <div class="connection-cards">
            <div class="connection-card" id="gmailCard">
                <div class="card-header">
                    <div class="card-title">
                        <i data-lucide="mail" class="card-icon"></i>
                        Gmail Intelligence
                    </div>
                    <span class="card-status status-pending" id="gmailStatus">Not Connected</span>
                </div>
                <div class="card-description">
                    We'll scan your inbox to understand which brands you actually trust, identify important school communications, and filter out the noise—so you never miss what matters to your family.
                </div>
                <div class="card-privacy">
                    <i data-lucide="eye-off"></i>
                    Read-only access • No emails stored • Processed locally
                </div>
                <button class="connect-btn" id="connectGmail">
                    <i data-lucide="link"></i>
                    Connect Gmail Securely
                </button>
            </div>
            
            <div class="connection-card" id="calendarCard">
                <div class="card-header">
                    <div class="card-title">
                        <i data-lucide="calendar" class="card-icon"></i>
                        Calendar Intelligence
                    </div>
                    <span class="card-status status-pending" id="calendarStatus">Not Connected</span>
                </div>
                <div class="card-description">
                    We'll understand your family's schedule chaos—school events, work meetings, kids' activities—and help you see patterns, conflicts, and opportunities to reduce scheduling stress.
                </div>
                <div class="card-privacy">
                    <i data-lucide="eye-off"></i>
                    Read-only access • No events stored • Local processing
                </div>
                <button class="connect-btn" id="connectCalendar" disabled>
                    <i data-lucide="calendar-plus"></i>
                    Connect Calendar Securely
                </button>
            </div>
        </div>
        
        <div class="continue-section">
            <button class="continue-btn" id="continueBtn">
                Begin Mental Load Analysis
                <i data-lucide="arrow-right"></i>
            </button>
            <a href="#" class="skip-link" id="skipLink">Skip for now (limited intelligence)</a>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();
        
        let gmailConnected = false;
        let calendarConnected = false;
        
        // Get user info from previous step
        const userInfo = JSON.parse(sessionStorage.getItem('onboarding_user') || '{}');
        
        // Gmail connection
        document.getElementById('connectGmail').addEventListener('click', function() {
            this.disabled = true;
            this.innerHTML = '<i data-lucide="loader-2"></i>Connecting...';
            lucide.createIcons();
            
            // Use existing Gmail OAuth flow
            window.location.href = '/auth/gmail?onboarding=true';
        });
        
        // Calendar connection
        document.getElementById('connectCalendar').addEventListener('click', function() {
            this.disabled = true;
            this.innerHTML = '<i data-lucide="loader-2"></i>Connecting...';
            lucide.createIcons();
            
            // TODO: Implement Google Calendar OAuth
            // For now, simulate connection
            setTimeout(() => {
                markCalendarConnected();
            }, 2000);
        });
        
        // Continue button
        document.getElementById('continueBtn').addEventListener('click', function() {
            if (gmailConnected) {
                // Store connection status
                sessionStorage.setItem('connections', JSON.stringify({
                    gmail: gmailConnected,
                    calendar: calendarConnected
                }));
                
                // Proceed to scanning
                window.location.href = '/scan';
            }
        });
        
        // Skip link
        document.getElementById('skipLink').addEventListener('click', function(e) {
            e.preventDefault();
            if (confirm('Are you sure? Skipping will limit your mental load intelligence capabilities.')) {
                window.location.href = '/app';
            }
        });
        
        // Helper functions
        function markGmailConnected() {
            gmailConnected = true;
            const card = document.getElementById('gmailCard');
            const status = document.getElementById('gmailStatus');
            const btn = document.getElementById('connectGmail');
            const calendarBtn = document.getElementById('connectCalendar');
            
            card.classList.add('connected');
            status.textContent = 'Connected';
            status.className = 'card-status status-connected';
            btn.innerHTML = '<i data-lucide="check"></i>Securely Connected';
            btn.disabled = true;
            
            // Enable calendar connection
            calendarBtn.disabled = false;
            
            lucide.createIcons();
            updateContinueButton();
        }
        
        function markCalendarConnected() {
            calendarConnected = true;
            const card = document.getElementById('calendarCard');
            const status = document.getElementById('calendarStatus');
            const btn = document.getElementById('connectCalendar');
            
            card.classList.add('connected');
            status.textContent = 'Connected';
            status.className = 'card-status status-connected';
            btn.innerHTML = '<i data-lucide="check"></i>Securely Connected';
            btn.disabled = true;
            
            lucide.createIcons();
            updateContinueButton();
        }
        
        function updateContinueButton() {
            const continueBtn = document.getElementById('continueBtn');
            if (gmailConnected) {
                continueBtn.classList.add('ready');
                continueBtn.disabled = false;
            }
        }
        
        // Check if returning from Gmail OAuth
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('gmail_connected') === 'true') {
            markGmailConnected();
        }
        
        // Listen for postMessage from OAuth popup
        window.addEventListener('message', function(event) {
            if (event.data.type === 'gmail_connected') {
                markGmailConnected();
            }
        });
    </script>
</body>
</html>
